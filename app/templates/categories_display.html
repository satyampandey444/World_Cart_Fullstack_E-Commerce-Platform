{% extends "base.html" %}
{% block title %}
    Add Category
{% endblock %}

{% block body %}

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, message in messages %}
    <div id="flash-messages"
         class="mx-auto max-w-lg px-6 py-4 mt-4 font-sans text-lg font-bold text-white bg-green-500 rounded-lg shadow-lg text-center">
      {{ message }}
    </div>
  {% endfor %}
{% endwith %}

<div class="container mx-auto px-4 py-8">

  <!-- Category List -->
  <div class="bg-white shadow-lg rounded-lg p-6 max-w-3xl mx-auto">

    <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Categories</h2>

    <ul id="categoryList" class="space-y-4">

      {% for product in products %}
      <li class="p-4 border rounded-lg bg-gray-100 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">

        <!-- Category Name -->
        <a href="" class="text-lg font-semibold text-gray-700 category-name">
          {{ product.name }}
        </a>

        <!-- Buttons (commented out as in original) -->
        {# 
        <div class="flex space-x-2">
          <button class="bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 shadow-md">
              Edit
          </button>
          <button class="bg-red-500 text-white px-3 py-1 rounded-md text-sm hover:bg-red-600 shadow-md">
              Delete
          </button>
        </div>
        #}

      </li>
      {% endfor %}

    </ul>

  </div>

</div>

<!-- JS (unchanged, but forms removed from page, so no effect) -->
<script>
  const categoryForm = document.getElementById('categoryForm');
  if (categoryForm) {
    categoryForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const categoryName = document.getElementById('categoryName').value;
      if (!categoryName) {
        alert("Please enter a category name.");
        return;
      }
      const response = await fetch('/api/add_category', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ categoryName: categoryName })
      });
      const result = await response.json();
      if (result.success) {
        location.reload();
      } else {
        alert("Error adding category.");
      }
    });
  }

  async function deleteCategory(categoryId) {
    if (!confirm("Are you sure you want to delete this category?")) return;
    const response = await fetch(`/api/delete_category/${categoryId}`, { method: 'DELETE' });
    if (response.ok) {
      location.reload();
    } else {
      alert("Error deleting category.");
    }
  }

  async function editCategory(categoryId) {
    const li = document.querySelector(`li[data-id="${categoryId}"]`);
    const nameSpan = li.querySelector('.category-name');
    const newName = prompt("Enter new category name:", nameSpan.textContent);

    if (!newName || !newName.trim()) {
      alert("Category name cannot be empty.");
      return;
    }

    const response = await fetch(`/api/edit_category/${categoryId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ categoryName: newName })
    });

    if (response.ok) location.reload();
    else alert("Error updating category.");
  }
</script>

{% endblock %}
